<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.8.17"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>=nil;&nbsp;Foundation&nbsp;Cryptography&nbsp;Library: Implementation</title>
    <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../../bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="../../jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <!-- SmartMenus jQuery Plugin -->
    <script type="text/javascript" src="../../jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="../../jquery.smartmenus.bootstrap.js"></script>
    <!-- highlight.js Syntax Highlighter -->
    <link rel="stylesheet" href="../../darkula.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script>
    <!--    <script>-->
    <!--        $(function () {-->
    <!--            $(".fragment").each(function (i, node) {-->
    <!--                var $node = $(node);-->
    <!--                $node.html("<pre><code class='" +-->
    <!--                    $node.attr("class") + "'>" +-->
    <!--                    $node.text() + "</code></pre>");-->
    <!--                hljs.highlightBlock(node);-->
    <!--            });-->
    <!--        });-->
    <!--    </script>-->
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand">=nil;&nbsp;Foundation&nbsp;Cryptography&nbsp;Library 0.3.0</a>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Hashes usage is usually split to three stages:</p>
<ol type="1">
<li>Initialization. Implicit stage with creation of accumulator to be used.</li>
<li>Accumulation. Performed one or more times. Calling update several times is equivalent to calling it once with all of the arguments concatenated.</li>
<li>Finalization. Accumulated hash data is required to be finalized, padded and prepared to be retrieved by user. <br  />
</li>
</ol>
<h1><a class="anchor" id="hash_arch"></a>
Architecture Overview</h1>
<p>Hashes library architecture consists of several parts listed below:</p>
<ol type="1">
<li>Algorithms</li>
<li>Stream Processors</li>
<li>Constructions and Compressors</li>
<li>Accumulators</li>
<li>Value Processors</li>
</ol>
<div class="dotgraph">
<img src="../../dot_inline_dotgraph_7.png" alt="dot_inline_dotgraph_7.png" border="0" usemap="#dot_inline_dotgraph_7.map"/>
<map name="dot_inline_dotgraph_7.map" id="dot_inline_dotgraph_7.map"><area shape="rect" href="../../d5/d7e/hash_impl.html#hash_algorithms" title="Algorithms" alt="" coords="82,5,189,53"/>
<area shape="rect" href="../../d5/d7e/hash_impl.html#hash_stream" title="Stream Processors" alt="" coords="55,101,215,149"/>
<area shape="rect" href="../../d5/d7e/hash_impl.html#hash_pol" title="Constructions and Compressors" alt="" coords="5,197,265,245"/>
<area shape="rect" href="../../d5/d7e/hash_impl.html#hash_acc" title="Accumulators" alt="" coords="72,293,199,341"/>
<area shape="rect" href="../../d5/d7e/hash_impl.html#hash_val" title="Value Processors" alt="" coords="60,389,211,437"/>
</map>
</div>
<h1><a class="anchor" id="hash_algorithms"></a>
Algorithms</h1>
<p>Implementation of a library is considered to be highly compliant with STL. So the crucial point is to have ciphers to be usable in the same way as STL algorithms do.</p>
<p>STL algorithms library mostly consists of generic iterator and since C++20 range-based algorithms over generic concept-compliant types. Great example is <code>std::transform</code> algorithm:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> InputIterator, <span class="keyword">typename</span> OutputIterator, <span class="keyword">typename</span> UnaryOperation&gt;</div>
<div class="line">OutputIterator <a class="code" href="../../dc/d40/namespacenil_1_1adaptors.html#ad96a2afccf4b1397d918e0fb74dbb63a">transform</a>(InputIterator first, InputIterator last, OutputIterator out, UnaryOperation unary_op);</div>
</div><!-- fragment --><p>Input values of type <code>InputIterator</code> operate over any iterable range, no matter which particular type is supposed to be processed. While <code>OutputIterator</code> provides a type-independent output place for the algorithm to put results no matter which particular range this <code>OutputIterator</code> represents.</p>
<p>Since C++20 this algorithm got it analogous inside Ranges library as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> InputRange, <span class="keyword">typename</span> OutputRange, <span class="keyword">typename</span> UnaryOperation&gt;</div>
<div class="line">OutputRange <a class="code" href="../../dc/d40/namespacenil_1_1adaptors.html#ad96a2afccf4b1397d918e0fb74dbb63a">transform</a>(InputRange rng, OutputRange out, UnaryOperation unary_op);</div>
</div><!-- fragment --><p>This particular modification takes no difference if <code>InputRange</code> is a <code>Container</code> or something else. The algorithm is generic just as data representation types are.</p>
<p>As much as such algorithms are implemented as generic ones, hash algorithms should follow that too:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Hash, <span class="keyword">typename</span> InputIterator, <span class="keyword">typename</span> OutputIterator&gt;</div>
<div class="line">OutputIterator <a class="code" href="../../d4/d1d/namespacenil_1_1crypto3_1_1accumulators_1_1extract.html#a38bec97acac9156762d67e8baaa428fd">hash</a>(InputIterator first, InputIterator last, OutputIterator out);</div>
</div><!-- fragment --><p><code>Hash</code> is a policy type which represents the particular hash will be used. <code>InputIterator</code> represents the input data coming to be hashed. <code>OutputIterator</code> is exactly the same as it was in <code>std::transform</code> algorithm - it handles all the output storage operations.</p>
<p>The most obvious difference between <code>std::transform</code> is a representation of a policy defining the particular behaviour of an algorithm. <code>std::transform</code> proposes to pass it as a reference to <code>Functor</code>, which is also possible in case of <code>Hash</code> policy used in function already pre-scheduled:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Hash, <span class="keyword">typename</span> InputIterator, <span class="keyword">typename</span> OutputIterator&gt;</div>
<div class="line">OutputIterator <a class="code" href="../../d4/d1d/namespacenil_1_1crypto3_1_1accumulators_1_1extract.html#a38bec97acac9156762d67e8baaa428fd">hash</a>(InputIterator first, InputIterator last, OutputIterator out);</div>
</div><!-- fragment --><p>Algorithms are no more than an internal structures initializer wrapper. In this particular case algorithm would initialize stream processor fed with accumulator set with `hash` accumulator inside initialized with <code>Hash</code>.</p>
<h1><a class="anchor" id="hash_stream"></a>
Stream Data Processing</h1>
<p>Hashes are usually defined for processing <code>Integral</code> value typed byte sequences of specific size packed in blocks (e.g. sha2 is defined for blocks of words which are actually plain <code>n</code>-sized arrays of <code>uint32_t</code> ). Input data in the implementation proposed is supposed to be a various-length input stream, which length could be not even to block size.</p>
<p>This requires an introduction of stream processor specified with particular parameter set unique for each `Hash` type, which takes input data stream and gets it split to blocks filled with converted to appropriate size integers (words in the cryptography meaning, not machine words).</p>
<p>Example. Lets assume input data stream consists of 16 bytes as follows.</p>
<div class="dotgraph">
<img src="../../dot_inline_dotgraph_8.png" alt="dot_inline_dotgraph_8.png" border="0" usemap="#dot_inline_dotgraph_8.map"/>
</div>
<p>Lets assume the selected cipher to be used is Rijndael with 32 bit word size, 128 bit block size and 128 bit key size. This means input data stream needs to be converted to 32 bit words and merged to 128 bit blocks as follows:</p>
<div class="dotgraph">
<img src="../../dot_inline_dotgraph_9.png" alt="dot_inline_dotgraph_9.png" border="0" usemap="#dot_inline_dotgraph_9.map"/>
</div>
<p>Now with this a `Hash` instance of sha2 can be fed.</p>
<p>This mechanism is handled with <code>stream_processor</code> template class specified for each particular cipher with parameters required. Hashes suppose only one type of stream processor exist - the one which split the data to blocks, converts them and passes to <code>AccumulatorSet</code> reference as cipher input of format required. The rest of data not even to block size gets converted too and fed value by value to the same <code>AccumulatorSet</code> reference.</p>
<h1><a class="anchor" id="hash_data"></a>
Data Type Conversion</h1>
<p>Since block cipher algorithms are usually defined for <code>Integral</code> types or byte sequences of unique format for each cipher, encryption function being generic requirement should be handled with particular cipher-specific input data format converter.</p>
<p>For example <code>Rijndael</code> cipher is defined over blocks of 32 bit words, which could be represented with <code>uint32_t</code>. This means all the input data should be in some way converted to 4 byte sized <code>Integral</code> type. In case of <code>InputIterator</code> is defined over some range of <code>Integral</code> value type, this is is handled with plain byte repack as shown in previous section. This is a case with both input stream and required data format are satisfy the same concept.</p>
<p>The more case with input data being presented by sequence of various type <code>T</code> requires for the <code>T</code> to has conversion operator <code>operator Integral()</code> to the type required by particular <code>BlockCipher</code> policy. <br  />
</p>
<p>Example. Let us assume the following class is presented: </p><div class="fragment"><div class="line"><span class="keyword">class </span>A {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    std::size_t vals;</div>
<div class="line">    std::uint16_t val16;</div>
<div class="line">    std::char valc;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Now let us assume there exists an initialized and filled with random values </p><div class="fragment"><div class="line"> {SequenceContainer```}</div>
<div class="line"> </div>
<div class="line">```cpp</div>
<div class="line">std::vector&lt;A&gt; a;</div>
</div><!-- fragment --><p>To feed the <code>BlockCipher</code> with the data presented, it is required to convert <code>A</code> to <code>Integral</code> type which is only available if <code>A</code> has conversion operator in some way as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>A {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">operator</span> uint128_t() {</div>
<div class="line">        <span class="keywordflow">return</span> (vals &lt;&lt; (3U * CHAR_BIT)) &amp; (val16 &lt;&lt; 16) &amp; valc </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::size_t vals;</div>
<div class="line">    std::uint16_t val16;</div>
<div class="line">    std::char valc;</div>
<div class="line">};</div>
</div><!-- fragment --><p>This part is handled internally with <code>stream_processor</code> configured for each particular cipher.</p>
<h1><a class="anchor" id="hash_pol"></a>
Hash Algorithms</h1>
<h1><a class="anchor" id="hash_acc"></a>
Accumulators</h1>
<h1><a class="anchor" id="hash_val"></a>
Value Postprocessors</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacenil_1_1crypto3_1_1accumulators_1_1extract_html_a38bec97acac9156762d67e8baaa428fd"><div class="ttname"><a href="../../d4/d1d/namespacenil_1_1crypto3_1_1accumulators_1_1extract.html#a38bec97acac9156762d67e8baaa428fd">nil::crypto3::accumulators::extract::hash</a></div><div class="ttdeci">boost::mpl::apply&lt; AccumulatorSet, tag::hash&lt; Hash &gt; &gt;::type::result_type hash(const AccumulatorSet &amp;acc)</div><div class="ttdef"><b>Definition:</b> accumulators/hash.hpp:164</div></div>
<div class="ttc" id="anamespacenil_1_1adaptors_html_ad96a2afccf4b1397d918e0fb74dbb63a"><div class="ttname"><a href="../../dc/d40/namespacenil_1_1adaptors.html#ad96a2afccf4b1397d918e0fb74dbb63a">nil::adaptors::transform</a></div><div class="ttdeci">decoded_range&lt; UnaryFunction, SinglePassRange &gt; transform(SinglePassRange &amp;rng, UnaryFunction fn)</div><div class="ttdef"><b>Definition:</b> decrypted.hpp:85</div></div>
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer"><!--<small>
Generated on Tue Feb 11 2020 13:11:44 for =nil;&nbsp;Foundation&nbsp;Cryptography&nbsp;Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small>--></address>
</body>
<script type="text/javascript" src="../../doxy_boot.js"></script>
</html>
